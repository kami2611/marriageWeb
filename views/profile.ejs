<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <%
  // ----------------------------
  // 🔹 DYNAMIC SEO VARIABLES
  // ----------------------------
  const appName = "D'amour Muslim";
  const city = profile.city || 'UK';
  const country = profile.country || 'United Kingdom';
  const genderLabel = profile.gender === 'male' ? 'Muslim Man' : 'Muslim Woman';
  const ethnicity = profile.ethnicity || 'Muslim';

  // 🔹 Dynamic Title
  const pageTitle = `${profile.username}, ${profile.age} | ${ethnicity} ${genderLabel} for Halal Marriage in ${city} | ${appName}`;

  // 🔹 Canonical Profile URL
  const profileUrl = `https://damourmuslim.com/profiles/${profile.profileSlug || profile._id}`;

  // 🔹 Profile Image Fallback
  const imageUrl = (profile.profilePic && profile.profilePic.url)
    ? profile.profilePic.url
    : 'https://damourmuslim.com/images/default-profile-og.jpg';

  // ----------------------------
  // 🔹 DYNAMIC KEYWORD LOGIC (5–8 per profile)
  // ----------------------------
  const baseKeywords = [
    "Muslim matrimony", "Halal marriage", "Muslim marriage UK", "Islamic marriage site",
    "Muslim matchmaking", "Halal Muslim marriage", "Muslim spouse search"
  ];

  const locationKeywords = city.toLowerCase().includes('london') ? [
    "Muslim marriage London", "Shaadi in London", "Find Halal Partner London", "Nikkah London", "London Rishta"
  ] : city.toLowerCase().includes('leicester') ? [
    "Leicester Muslim marriage", "Muslim rishta Leicester", "Pakistani shaadi Leicester"
  ] : city.toLowerCase().includes('birmingham') ? [
    "Muslim marriage Birmingham", "Muslim shaadi Birmingham", "Birmingham shaadi"
  ] : [
    "Muslim marriage site UK", "Halal marriage site UK", "Muslim matrimonial UK"
  ];

  const ethnicityKeywords = ethnicity.toLowerCase().includes('pakistani') ? [
    "Pakistani Muslim wedding", "Pakistani marriage", "Pakistani nikkah", "Pakistani shaadi", "Pakistani Muslim"
  ] : ethnicity.toLowerCase().includes('bengali') ? [
    "Bengali Muslim wedding", "Bengali wedding", "Bengali Muslim marriage"
  ] : ethnicity.toLowerCase().includes('arab') ? [
    "Arab Muslim wedding", "Arab Muslim marriage", "Arab Muslim"
  ] : [
    "Muslim wedding", "Islamic wedding", "Nikkah ceremony", "Sunnah marriage"
  ];

  const keywordList = [...baseKeywords, ...locationKeywords, ...ethnicityKeywords].join(', ');

  // ----------------------------
  // 🔹 META & OG DESCRIPTIONS (SEO-Optimized)
  // ----------------------------
  const metaDescription = `View ${profile.username}’s verified ${ethnicity} ${genderLabel.toLowerCase()} profile for halal Muslim marriage in ${city}, UK. Join ${appName} to find genuine Muslim singles, nikah profiles, and rishta services across the UK.`;

  const richDescription = `${profile.username}, ${profile.age}, from ${city}, ${country} — a ${ethnicity} ${genderLabel.toLowerCase()} seeking halal Muslim marriage. Connect on ${appName}, the trusted Islamic matrimony and matchmaking site for UK Muslims.`;
  %>

  <!-- ✅ SEO Title & Meta -->
  <title><%= pageTitle %></title>
  <meta name="description" content="<%= metaDescription %>">
  <meta name="keywords" content="<%= keywordList %>">
  <link rel="canonical" href="<%= profileUrl %>">

  <!-- ✅ Favicon & Theme -->
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
  <link rel="manifest" href="/images/site.webmanifest">
  <meta name="theme-color" content="#E91E63">

  <!-- ✅ Open Graph / Facebook -->
  <meta property="og:type" content="profile">
  <meta property="og:url" content="<%= profileUrl %>">
  <meta property="og:title" content="<%= pageTitle %>">
  <meta property="og:description" content="<%= richDescription %>">
  <meta property="og:image" content="<%= imageUrl %>">
  <meta property="og:image:width" content="400">
  <meta property="og:image:height" content="400">
  <meta property="og:site_name" content="D'amour Muslim">
  <meta property="og:image:alt" content="<%= profile.username %>'s verified Muslim marriage profile">
  <meta property="og:locale" content="en_GB">

  <!-- ✅ Profile-specific OG -->
  <meta property="profile:first_name" content="<%= profile.username %>">
  <meta property="profile:username" content="<%= profile.username %>">
  <meta property="profile:gender" content="<%= profile.gender %>">

  <!-- ✅ Twitter Meta -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@damourmuslim">
  <meta name="twitter:title" content="<%= pageTitle %>">
  <meta name="twitter:description" content="<%= richDescription %>">
  <meta name="twitter:image" content="<%= imageUrl %>">

  <!-- ✅ JSON-LD Structured Data (Person Schema for Muslim Marriage Profiles) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "<%= profile.username %>",
    "gender": "<%= profile.gender %>",
    "birthDate": "<%= profile.age ? (new Date().getFullYear() - profile.age) + '-01-01' : '' %>",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "<%= city %>",
      "addressCountry": "<%= country %>"
    },
    "image": "<%= imageUrl %>",
    "url": "<%= profileUrl %>",
    "description": "<%= richDescription %>",
    "sameAs": [
      "https://damourmuslim.com",
      "https://www.facebook.com/damourmuslim",
      "https://www.instagram.com/damourmuslim"
    ],
    "knowsAbout": [<%= keywordList.split(',').map(k => `"${k.trim()}"`).join(', ') %>]
  }
  </script>
  <link rel="stylesheet" href="/css/output.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Playfair+Display:wght@400;600;700&family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
  <style>
    :where([class^="ri-"])::before {
      content: "\f3c2";
    }

    .material-shadow {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .material-shadow-hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .material-shadow-elevated {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .ripple {
      position: relative;
      overflow: hidden;
    }

    .ripple::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .ripple:active::before {
      width: 300px;
      height: 300px;
    }

    .gradient-bg {
      background: linear-gradient(135deg, #E91E63 0%, #673AB7 100%);
    }

    .animate-spin {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    #shareProfileBtn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    #profileCard img {
      max-width: 100%;
      height: auto;
    }

    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>
<% if (isProd && !isAdmin) { %>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=<%= GA_ID %>"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());
  gtag('config', '<%= GA_ID %>');
</script>
<% } %>


<body class="bg-gray-50 font-['Roboto']">
  <!-- Header remains the same -->
  <%- include('partials/header') %>
  <main class="pb-16 min-h-screen">
    <div class="max-w-7xl mx-auto">
      <div class="flex gap-8">
        <!-- Filter Sidebar -->
        <div class="w-80 flex-shrink-0 hidden lg:block">
          <%- include('partials/profilesFilter') %>
        </div>

        <!-- Main Content -->
        <div class="flex-1">
          <div class="max-w-3xl mx-auto px-6">
            <div class="bg-white rounded-2xl overflow-hidden material-shadow mb-6">
              <!-- Cover Photo -->
              <div class="aspect-[3/2] relative overflow-hidden">
                <% if (profile.coverPhoto && profile.coverPhoto.url) { %>
                <img src="<%= profile.coverPhoto.url %>" class="w-full h-full object-cover" alt="<%=  profile.username %>'s Cover">
                <% } else { %>
                <!-- Default cover image based on gender -->
                <% if (profile.gender === 'male') { %>
                <div class="w-full h-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center">
                  <i class="ri-user-line text-8xl text-white opacity-30"></i>
                </div>
                <% } else { %>
                <div class="w-full h-full bg-gradient-to-br from-pink-400 to-pink-600 flex items-center justify-center">
                  <i class="ri-user-3-line text-8xl text-white opacity-30"></i>
                </div>
                <% } %>
                <% } %>
                <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black/60 to-transparent"></div>
              </div>

              <!-- Profile Content -->
              <div class="relative -mt-24 px-8 pb-8">
                <!-- Profile Picture -->
                <div class="w-48 h-48 rounded-full overflow-hidden border-4 border-white material-shadow mx-auto mb-6">
                  <% if (profile.profilePic && profile.profilePic.url) { %>
                  <img src="<%= profile.profilePic.url %>" class="w-full h-full object-cover" alt="<%=  profile.username %>'s Profile">
                  <% } else { %>
                  <!-- Default avatar based on gender -->
                  <% if (profile.gender === 'male') { %>
                  <img src="https://ui-avatars.com/api/?name=<%= encodeURIComponent( profile.username) %>&background=0077be&color=fff&size=400&rounded=false&bold=true&format=png" class="w-full h-full object-cover" alt="<%= profile.username %>'s Profile">
                  <% } else { %>
                  <img src="https://ui-avatars.com/api/?name=<%= encodeURIComponent( profile.username) %>&background=e91e63&color=fff&size=400&rounded=false&bold=true&format=png" class="w-full h-full object-cover" alt="<%= profile.username %>'s Profile">
                  <% } %>
                  <% } %>
                </div>

                <!-- Name and Verification -->
                <!-- Name and Verification -->
                <div class="text-center mb-8">
                  <h1 class="text-3xl font-bold text-gray-900 mb-2 font-['Playfair_Display']">
                    <i class="ri-verified-badge-fill text-primary"></i>
                    <%=  profile.username %>
                    <% if (user && user._id && user._id.toString() === profile._id.toString()) { %>
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 ml-3">
                      <i class="ri-user-line mr-1"></i>
                      You
                    </span>
                    <% } %>
                  </h1>
                </div>
                <!-- Add this right after the name and verification section -->
                <!-- <div class="text-center mb-6">
                  <button id="shareProfileBtn" class="inline-flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-all duration-300 shadow-md">
                    <i id="shareIcon" class="ri-share-line"></i>
                    <span id="shareText">Share Profile</span>
                  </button>
                </div> -->
                <!-- Add this right after the name and verification section -->
                <div class="text-center mb-6">
                  <div class="flex items-center justify-center gap-3">
                    <% if (user && user._id && user._id.toString() === profile._id.toString()) { %>
                    <!-- Edit Profile Button (only for own profile) -->
                    <a href="/account" class="inline-flex items-center gap-2 px-4 py-2 bg-primary hover:bg-pink-600 text-white rounded-lg transition-all duration-300 shadow-md">
                      <i class="ri-edit-line"></i>
                      <span>Edit Profile</span>
                    </a>
                    <% } %>

                    <!-- Share Profile Button -->
                    <button id="shareProfileBtn" class="inline-flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-all duration-300 shadow-md">
                      <i id="shareIcon" class="ri-share-line"></i>
                      <span id="shareText">Share Profile</span>
                    </button>
                  </div>
                </div>
                <!-- Hidden canvas for generating image - UPDATED to be dynamic -->
                <div id="profileCard" style="position: absolute; left: -9999px; top: -9999px;">
                  <div id="shareCanvas" style="width: 450px; min-width: 450px; max-width: 450px; padding: 20px; background: <%= profile.gender === 'female' ? 'linear-gradient(135deg, #F6D6E5 0%, #F1CCDE 50%, #F4C4DC 100%)' : 'linear-gradient(135deg, #89cff0 0%)' %>; border-radius: 16px; color: #2D3748; font-family: 'Roboto', sans-serif; font-size: 13px; border: 2px solid; box-sizing: border-box; overflow: visible; height: auto;">
                    <!-- This will be populated dynamically by JavaScript -->
                  </div>
                </div>
                <!-- Public Information (Always Visible) -->
                <div class="space-y-8">
                  <div class="bg-gray-50 rounded-xl p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6 font-['Playfair_Display']">Public Information</h2>
                    <div class="grid md:grid-cols-2 gap-6">
                      <div class="space-y-4">
                        <% if (profile.gender) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/10 text-primary">
                            <i class="<%= profile.gender === 'male' ? 'ri-user-line' : 'ri-user-3-line' %>"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Gender</p>
                            <p class="text-gray-900 capitalize"><%= profile.gender %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.age) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/10 text-primary">
                            <i class="ri-calendar-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Age</p>
                            <p class="text-gray-900"><%= profile.age %> years</p>
                          </div>
                        </div>
                        <% } %>

                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/10 text-primary">
                            <i class="ri-map-pin-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Location</p>
                            <p class="text-gray-900">
                              <% if (profile.city && profile.country) { %>
                              <%= profile.city %>, <%= profile.country %>
                              <% } else if (profile.city) { %>
                              <%= profile.city %>
                              <% } else if (profile.country) { %>
                              <%= profile.country %>
                              <% } else { %>
                              Location not specified
                              <% } %>
                            </p>
                          </div>
                        </div>

                        <% if (profile.nationality) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/10 text-primary">
                            <i class="ri-flag-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Nationality</p>
                            <p class="text-gray-900"><%= profile.nationality %></p>
                          </div>
                        </div>
                        <% } %>
                      </div>

                      <div class="space-y-4">
                        <% if (profile.height) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/10 text-primary">
                            <i class="ri-ruler-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Height</p>
                            <p class="text-gray-900"><%= (profile.height / 30.48).toFixed(1) %> ft</p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.education && profile.education.length > 0) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/10 text-primary">
                            <i class="ri-graduation-cap-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Education</p>
                            <p class="text-gray-900"><%= profile.education[0].title || 'Education details available' %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.work) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/10 text-primary">
                            <i class="ri-briefcase-4-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Work</p>
                            <p class="text-gray-900"><%= profile.work %></p>
                          </div>
                        </div>
                        <% } %>
                      </div>
                    </div>

                    <!-- About Me Section (Public) -->
                    <% if (profile.aboutMe) { %>
                    <div class="mt-6 pt-6 border-t border-gray-200">
                      <h3 class="text-lg font-semibold text-gray-900 mb-3">About Me</h3>
                      <p class="text-gray-700 leading-relaxed"><%= profile.aboutMe %></p>
                    </div>
                    <% } %>

                    <!-- Full Education Details (Public) -->
                    <% if (profile.education && profile.education.length > 0) { %>
                    <div class="mt-6 pt-6 border-t border-gray-200">
                      <h3 class="text-lg font-semibold text-gray-900 mb-3">Education Background</h3>
                      <div class="space-y-3">
                        <% profile.education.forEach(edu => { %>
                        <div class="bg-white rounded-lg p-4 border border-gray-200">
                          <% if (edu.institute) { %>
                          <h4 class="font-bold text-lg text-gray-900 mb-1"><%= edu.institute %></h4>
                          <% } %>
                          <% if (edu.title) { %>
                          <p class="text-gray-700 mb-1"><%= edu.title %></p>
                          <% } %>
                          <% if (edu.year) { %>
                          <p class="text-xs text-gray-500"><%= edu.year %></p>
                          <% } %>
                        </div>
                        <% }) %>
                      </div>
                    </div>
                    <% } %>
                  </div>

                  <!-- Private Information Section -->
                  <div class="bg-gray-50 rounded-xl p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 font-['Playfair_Display']">
                      Private Information
                    </h2>

                    <% if (canAccessFullProfile || (user && user._id && user._id.toString() === profile._id.toString())) { %>
                    <!-- Show ALL private information for admin or users with access -->
                    <div class="grid md:grid-cols-2 gap-6">
                      <div class="space-y-4">
                        <!-- Basic Contact & Personal -->


                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-green-100 text-green-600">
                            <i class="ri-phone-line"></i>
                          </div>
                          <div>
                            <% if (user.isAdmin) { %>
                            <% if (profile.contact) { %>
                            <p class="text-sm text-gray-500">Contact</p>
                            <p class="text-gray-900"><%= profile.contact %></p>
                            <% } %>
                            <% } else { %>
                            <p class="text-sm text-gray-500">Contact</p>
                            <p class="text-gray-900">7454516156</p>
                            <% } %>
                          </div>
                        </div>


                        <% if (profile.religion) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-primary/10 text-primary">
                            <i class="ri-book-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Religion</p>
                            <p class="text-gray-900">
                              <%= profile.religion %>
                              <% if (profile.caste) { %> - <%= profile.caste %><% } %>
                            </p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.maritalStatus && profile.maritalStatus !== 'N/A') { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-blue-100 text-blue-600">
                            <i class="ri-heart-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Marital Status</p>
                            <p class="text-gray-900 capitalize"><%= profile.maritalStatus %></p>
                          </div>
                        </div>
                        <% } %>

                        <!-- Address Information -->
                        <% if (profile.adress) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-gray-600">
                            <i class="ri-home-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Address</p>
                            <p class="text-gray-900"><%= profile.adress %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.state) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-gray-600">
                            <i class="ri-map-2-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">State</p>
                            <p class="text-gray-900"><%= profile.state %></p>
                          </div>
                        </div>
                        <% } %>

                        <!-- Physical Characteristics -->
                        <% if (profile.eyeColor && profile.eyeColor !== 'N/A') { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-purple-100 text-purple-600">
                            <i class="ri-eye-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Eye Color</p>
                            <p class="text-gray-900 capitalize"><%= profile.eyeColor %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.hairColor && profile.hairColor !== 'N/A') { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-yellow-100 text-yellow-600">
                            <i class="ri-scissors-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Hair Color</p>
                            <p class="text-gray-900 capitalize"><%= profile.hairColor %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.beard && profile.beard !== 'N/A' && profile.gender === 'male') { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-amber-100 text-amber-600">
                            <i class="ri-user-star-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Beard</p>
                            <p class="text-gray-900 capitalize"><%= profile.beard %></p>
                          </div>
                        </div>
                        <% } %>

                        <!-- **NEW**: Hijab field for females -->
                        <% if (profile.wearHijab && profile.wearHijab !== 'N/A' && profile.gender === 'female') { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-pink-100 text-pink-600">
                            <i class="ri-user-3-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Wears Hijab</p>
                            <p class="text-gray-900 capitalize"><%= profile.wearHijab === 'yes' ? 'Yes' : 'No' %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.complexion && profile.complexion !== 'N/A') { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-orange-100 text-orange-600">
                            <i class="ri-palette-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Complexion</p>
                            <p class="text-gray-900 capitalize"><%= profile.complexion %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.build && profile.build !== 'N/A') { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-blue-100 text-blue-600">
                            <i class="ri-body-scan-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Build</p>
                            <p class="text-gray-900 capitalize"><%= profile.build %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.ethnicity && profile.ethnicity !== 'N/A') { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-teal-100 text-teal-600">
                            <i class="ri-global-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Ethnicity</p>
                            <p class="text-gray-900 capitalize"><%= profile.ethnicity %></p>
                          </div>
                        </div>
                        <% } %>
                      </div>

                      <div class="space-y-4">
                        <!-- Languages -->
                        <% if (profile.languagesSpoken && profile.languagesSpoken.length > 0) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-indigo-100 text-indigo-600">
                            <i class="ri-translate-2"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Languages</p>
                            <p class="text-gray-900"><%= profile.languagesSpoken.join(', ') %></p>
                          </div>
                        </div>
                        <% } %>

                        <!-- Health & Lifestyle -->
                        <% if (profile.disability && profile.disability !== 'no') { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-red-100 text-red-600">
                            <i class="ri-wheelchair-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Disability</p>
                            <p class="text-gray-900"><%= profile.disability %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.smoker !== undefined) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-gray-600">
                            <i class="ri-smoking-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Smoker</p>
                            <p class="text-gray-900"><%= profile.smoker ? 'Yes' : 'No' %></p>
                          </div>
                        </div>
                        <% } %>

                        <!-- Religious Information -->
                        <% if (profile.bornMuslim !== undefined) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-green-100 text-green-600">
                            <i class="ri-user-heart-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Born Muslim</p>
                            <p class="text-gray-900"><%= profile.bornMuslim ? 'Yes' : 'No' %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.islamicSect) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-teal-100 text-teal-600">
                            <i class="ri-book-open-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Islamic Sect</p>
                            <p class="text-gray-900"><%= profile.islamicSect %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.prays !== undefined) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-purple-100 text-purple-600">
                            <i class="ri-time-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Prays Regularly</p>
                            <p class="text-gray-900"><%= profile.prays ? 'Yes' : 'No' %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.celebratesMilaad !== undefined) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-pink-100 text-pink-600">
                            <i class="ri-calendar-event-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Celebrates Milaad</p>
                            <p class="text-gray-900"><%= profile.celebratesMilaad ? 'Yes' : 'No' %></p>
                          </div>
                        </div>
                        <% } %>

                        <% if (profile.celebrateKhatams !== undefined) { %>
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 flex items-center justify-center rounded-full bg-indigo-100 text-indigo-600">
                            <i class="ri-book-read-line"></i>
                          </div>
                          <div>
                            <p class="text-sm text-gray-500">Celebrates Khatams</p>
                            <p class="text-gray-900"><%= profile.celebrateKhatams ? 'Yes' : 'No' %></p>
                          </div>
                        </div>
                        <% } %>
                      </div>
                    </div>

                    <!-- Extended Sections -->

                    <!-- Hobbies Section -->
                    <% if (profile.hobbies && profile.hobbies.length > 0) { %>
                    <div class="mt-6 pt-6 border-t border-gray-200">
                      <h3 class="text-lg font-semibold text-gray-900 mb-3">Hobbies & Interests</h3>
                      <div class="flex flex-wrap gap-2">
                        <% profile.hobbies.forEach(hobby => { %>
                        <span class="px-3 py-1 bg-primary/10 text-primary rounded-full text-sm"><%= hobby %></span>
                        <% }) %>
                      </div>
                    </div>
                    <% } %>

                    <!-- Family Information -->
                    <% if (profile.fatherName || profile.motherName || profile.fatherProfession || profile.siblings || profile.birthPlace) { %>
                    <div class="mt-6 pt-6 border-t border-gray-200">
                      <h3 class="text-lg font-semibold text-gray-900 mb-3">Family Information</h3>
                      <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-3">
                          <% if (profile.siblings !== undefined) { %>
                          <div class="bg-white rounded-lg p-3 border border-gray-200">
                            <p class="text-sm text-gray-500">Siblings</p>
                            <p class="text-gray-900"><%= profile.siblings %></p>
                          </div>
                          <% } %>

                          <% if (profile.birthPlace) { %>
                          <div class="bg-white rounded-lg p-3 border border-gray-200">
                            <p class="text-sm text-gray-500">Birth Place</p>
                            <p class="text-gray-900"><%= profile.birthPlace %></p>
                          </div>
                          <% } %>

                          <% if (profile.children && profile.children.length > 0) { %>
                          <div class="bg-white rounded-lg p-3 border border-gray-200">
                            <p class="text-sm text-gray-500">Children</p>
                            <% profile.children.forEach(child => { %>
                            <div class="mt-1">
                              <p class="text-gray-900"><%= child.name %> (Age: <%= child.age %>)</p>
                              <% if (child.livingLocation) { %>
                              <p class="text-sm text-gray-600">Lives in: <%= child.livingLocation %></p>
                              <% } %>
                            </div>
                            <% }) %>
                          </div>
                          <div class="space-y-3">
                            <% if (profile.fatherName) { %>
                            <div class="bg-white rounded-lg p-3 border border-gray-200">
                              <p class="text-sm text-gray-500">Father's Name</p>
                              <p class="text-gray-900"><%= profile.fatherName %></p>
                            </div>
                            <% } %>

                            <% if (profile.motherName) { %>
                            <div class="bg-white rounded-lg p-3 border border-gray-200">
                              <p class="text-sm text-gray-500">Mother's Name</p>
                              <p class="text-gray-900"><%= profile.motherName %></p>
                            </div>
                            <% } %>

                            <% if (profile.fatherProfession) { %>
                            <div class="bg-white rounded-lg p-3 border border-gray-200">
                              <p class="text-sm text-gray-500">Father's Profession</p>
                              <p class="text-gray-900"><%= profile.fatherProfession %></p>
                            </div>
                            <% } %>
                          </div>

                          <% } %>
                        </div>
                      </div>
                    </div>
                    <% } %>

                    <!-- Islamic Values & Beliefs -->
                    <% if (profile.islamIsImportantToMeInfo || profile.acceptSomeoneWithChildren !== undefined || profile.acceptADivorcedPerson !== undefined || profile.agreesWithPolygamy !== undefined || profile.acceptAWidow !== undefined || profile.AcceptSomeoneWithBeard !== undefined || profile.AcceptSomeoneWithHijab !== undefined || profile.ConsiderARevert !== undefined) { %>
                    <div class="mt-6 pt-6 border-t border-gray-200">
                      <h3 class="text-lg font-semibold text-gray-900 mb-3">Islamic Values & Preferences</h3>

                      <% if (profile.islamIsImportantToMeInfo) { %>
                      <div class="bg-white rounded-lg p-4 border border-gray-200 mb-4">
                        <p class="text-sm text-gray-500 mb-2">Why Islam is Important to Me</p>
                        <p class="text-gray-900"><%= profile.islamIsImportantToMeInfo %></p>
                      </div>
                      <% } %>

                      <div class="grid md:grid-cols-2 gap-4">
                        <% if (profile.acceptSomeoneWithChildren !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Accept Someone With Children</p>
                          <p class="text-gray-900"><%= profile.acceptSomeoneWithChildren ? 'Yes' : 'No' %></p>
                        </div>
                        <% } %>

                        <% if (profile.acceptADivorcedPerson !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Accept Divorced Person</p>
                          <p class="text-gray-900"><%= profile.acceptADivorcedPerson ? 'Yes' : 'No' %></p>
                        </div>
                        <% } %>

                        <% if (profile.agreesWithPolygamy !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Agrees With Polygamy</p>
                          <p class="text-gray-900"><%= profile.agreesWithPolygamy ? 'Yes' : 'No' %></p>
                        </div>
                        <% } %>

                        <% if (profile.acceptAWidow !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Accept Widow</p>
                          <p class="text-gray-900"><%= profile.acceptAWidow ? 'Yes' : 'No' %></p>
                        </div>
                        <% } %>

                        <% if (profile.AcceptSomeoneWithBeard !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Accept Someone With Beard</p>
                          <p class="text-gray-900"><%= profile.AcceptSomeoneWithBeard ? 'Yes' : 'No' %></p>
                        </div>
                        <% } %>

                        <% if (profile.AcceptSomeoneWithHijab !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Accept Someone With Hijab</p>
                          <p class="text-gray-900"><%= profile.AcceptSomeoneWithHijab ? 'Yes' : 'No' %></p>
                        </div>
                        <% } %>

                        <% if (profile.ConsiderARevert !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Consider A Revert</p>
                          <p class="text-gray-900"><%= profile.ConsiderARevert ? 'Yes' : 'No' %></p>
                        </div>
                        <% } %>
                      </div>
                    </div>
                    <% } %>

                    <!-- Future Plans & Lifestyle -->
                    <% if (profile.livingArrangementsAfterMarriage || profile.futurePlans || profile.describeNature || profile.willingToRelocate !== undefined) { %>
                    <div class="mt-6 pt-6 border-t border-gray-200">
                      <h3 class="text-lg font-semibold text-gray-900 mb-3">Future Plans & Lifestyle</h3>
                      <div class="grid md:grid-cols-2 gap-4">
                        <% if (profile.livingArrangementsAfterMarriage && profile.livingArrangementsAfterMarriage !== 'N/A') { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Living Arrangements After Marriage</p>
                          <p class="text-gray-900 capitalize"><%= profile.livingArrangementsAfterMarriage %></p>
                        </div>
                        <% } %>

                        <% if (profile.futurePlans && profile.futurePlans !== 'N/A') { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Future Plans</p>
                          <p class="text-gray-900 capitalize"><%= profile.futurePlans %></p>
                        </div>
                        <% } %>

                        <% if (profile.willingToRelocate !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Willing to Relocate</p>
                          <p class="text-gray-900"><%= profile.willingToRelocate %> </p>
                        </div>
                        <% } %>
                      </div>

                      <% if (profile.describeNature) { %>
                      <div class="bg-white rounded-lg p-4 border border-gray-200 mt-4">
                        <p class="text-sm text-gray-500 mb-2">Describe Your Nature</p>
                        <p class="text-gray-900"><%= profile.describeNature %></p>
                      </div>
                      <% } %>
                    </div>
                    <% } %>

                    <!-- Qualities & Partner Preferences -->
                    <% if (profile.QualitiesThatYouCanBringToYourMarriage || profile.preferredAgeRange || profile.preferredHeightRange || profile.preferredCaste || profile.preferredEthnicity || profile.allowParnterToWork !== undefined || profile.allowPartnerToStudy !== undefined || profile.acceptSomeoneInOtherCountry !== undefined || profile.qualitiesYouNeedInYourPartner || profile.lookingForASpouseThatIs) { %>
                    <div class="mt-6 pt-6 border-t border-gray-200">
                      <h3 class="text-lg font-semibold text-gray-900 mb-3">Partner Preferences & Qualities</h3>

                      <% if (profile.QualitiesThatYouCanBringToYourMarriage && profile.QualitiesThatYouCanBringToYourMarriage.length > 0) { %>
                      <div class="bg-white rounded-lg p-4 border border-gray-200 mb-4">
                        <p class="text-sm text-gray-500 mb-2">Qualities I Can Bring to Marriage</p>
                        <div class="flex flex-wrap gap-2">
                          <% profile.QualitiesThatYouCanBringToYourMarriage.forEach(quality => { %>
                          <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm"><%= quality %></span>
                          <% }) %>
                        </div>
                      </div>
                      <% } %>

                      <% if (profile.qualitiesYouNeedInYourPartner && profile.qualitiesYouNeedInYourPartner.length > 0) { %>
                      <div class="bg-white rounded-lg p-4 border border-gray-200 mb-4">
                        <p class="text-sm text-gray-500 mb-2">Qualities I Need in My Partner</p>
                        <div class="flex flex-wrap gap-2">
                          <% profile.qualitiesYouNeedInYourPartner.forEach(quality => { %>
                          <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm"><%= quality %></span>
                          <% }) %>
                        </div>
                      </div>
                      <% } %>

                      <div class="grid md:grid-cols-2 gap-4">
                        <% if (profile.preferredAgeRange) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Preferred Age Range</p>
                          <p class="text-gray-900"><%= profile.preferredAgeRange %></p>
                        </div>
                        <% } %>

                        <% if (profile.preferredHeightRange) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Preferred Height Range</p>
                          <p class="text-gray-900"><%= profile.preferredHeightRange %></p>
                        </div>
                        <% } %>

                        <% if (profile.preferredCaste) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Preferred Caste</p>
                          <p class="text-gray-900"><%= profile.preferredCaste %></p>
                        </div>
                        <% } %>

                        <% if (profile.preferredEthnicity) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Preferred Ethnicity</p>
                          <p class="text-gray-900"><%= profile.preferredEthnicity %></p>
                        </div>
                        <% } %>

                        <% if (profile.allowParnterToWork !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Allow Partner to Work</p>
                          <p class="text-gray-900"><%= profile.allowParnterToWork ? 'Yes' : 'No' %></p>
                        </div>
                        <% } %>

                        <% if (profile.allowPartnerToStudy !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Allow Partner to Study</p>
                          <p class="text-gray-900"><%= profile.allowPartnerToStudy ? 'Yes' : 'No' %></p>
                        </div>
                        <% } %>

                        <% if (profile.acceptSomeoneInOtherCountry !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Accept Someone in Other Country</p>
                          <p class="text-gray-900"><%= profile.acceptSomeoneInOtherCountry ? 'Yes' : 'No' %></p>
                        </div>
                        <% } %>

                        <% if (profile.lookingForASpouseThatIs) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Looking for Spouse That Is</p>
                          <p class="text-gray-900"><%= profile.lookingForASpouseThatIs %></p>
                        </div>
                        <% } %>

                        <% if (profile.willingToConsiderANonUkCitizen !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Willing to Consider Non-UK Citizen</p>
                          <p class="text-gray-900"><%= profile.willingToConsiderANonUkCitizen ? 'Yes' : 'No' %></p>
                        </div>
                        <% } %>
                      </div>
                    </div>
                    <% } %>

                    <!-- Additional Information & Contact -->
                    <% if (profile.willingToSharePhotosUponRequest !== undefined || profile.willingToMeetUpOutside !== undefined || profile.waliMyContactDetails || profile.whoCompletedProfile || profile.anySpecialInformationPeopleShouldKnow) { %>
                    <div class="mt-6 pt-6 border-t border-gray-200">
                      <h3 class="text-lg font-semibold text-gray-900 mb-3">Additional Information</h3>

                      <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <% if (profile.willingToSharePhotosUponRequest !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Willing to Share Photos Upon Request</p>
                          <p class="text-gray-900"><%= profile.willingToSharePhotosUponRequest %> </p>
                        </div>
                        <% } %>

                        <% if (profile.willingToMeetUpOutside !== undefined) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Willing to Meet Up Outside</p>
                          <p class="text-gray-900"><%= profile.willingToMeetUpOutside %></p>
                        </div>
                        <% } %>

                        <% if (profile.whoCompletedProfile) { %>
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                          <p class="text-sm text-gray-500">Profile Completed By</p>
                          <p class="text-gray-900"><%= profile.whoCompletedProfile %></p>
                        </div>
                        <% } %>
                      </div>

                      <div class="bg-white rounded-lg p-4 border border-gray-200 mb-4">
                        <p class="text-sm text-gray-500 mb-2">Wali Contact Details</p>
                        <p class="text-gray-900">7454516156</p>
                      </div>


                      <% if (profile.anySpecialInformationPeopleShouldKnow) { %>
                      <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <p class="text-sm text-gray-500 mb-2">Special Information</p>
                        <p class="text-gray-900"><%= profile.anySpecialInformationPeopleShouldKnow %></p>
                      </div>
                      <% } %>
                    </div>
                    <% } %>

                    <% } else { %>
                    <!-- Request access to private profile information -->
                    <div class="text-center space-y-4">
                      <div class="flex items-center justify-center gap-2 text-gray-600 mb-4">
                        <i class="ri-lock-line"></i>
                        <p>Detailed private information is protected</p>
                      </div>

                      <div class="bg-blue-50 rounded-lg p-4 mb-6">
                        <div class="flex items-start gap-3">
                          <i class="ri-information-line text-blue-600 text-xl mt-0.5"></i>
                          <div class="text-left">
                            <h4 class="font-medium text-blue-900 mb-1">How Profile Sharing Works</h4>
                            <p class="text-sm text-blue-700">When you request access, your private information will be shared with this person. If they accept your request, you'll both be able to see each other's complete profiles including contact details, family information, religious preferences, and partner expectations.</p>
                          </div>
                        </div>
                      </div>

                      <% if (!hasalreadysentrequest && user && !user.isAdmin) { %>
                      <button id="requestAccessBtn" data-profile-id="<%= profile._id %>" class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-white hover:bg-pink-600 transition-all duration-300 !rounded-button whitespace-nowrap ripple material-shadow">
                        <i class="ri-profile-line"></i>
                        <span>Request Profile Sharing</span>
                      </button>
                      <p class="text-sm text-gray-500 mt-2">By clicking this button, you agree to share your private information with this person</p>
                      <% } else if (hasalreadysentrequest) { %>
                      <div class="inline-flex items-center gap-2 px-6 py-3 bg-gray-100 text-gray-600 rounded-button">
                        <i class="ri-time-line"></i>
                        <span>Profile Sharing Request Pending</span>
                      </div>
                      <p class="text-sm text-gray-500 mt-2">Your request is pending. You'll be notified when they respond.</p>
                      <% } else if (!user) { %>
                      <a href="/login" class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-white hover:bg-pink-600 transition-all duration-300 !rounded-button whitespace-nowrap ripple material-shadow">
                        <i class="ri-login-box-line"></i>
                        <span>Login to View Full Profile</span>
                      </a>
                      <% } %>
                    </div>
                    <% } %>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Only show registration form if user is not logged in -->
          <% if (!user) { %>
          <!-- Registration form section -->
          <div class="max-w-md mx-auto px-6">
            <!-- ... existing registration form ... -->
          </div>
          <% } %>

  </main>

  <!-- Footer remains the same -->
  <%- include('partials/footer') %>

  <script id="profile-interactions">
    document.addEventListener('DOMContentLoaded', function() {
      // Request access button
      const requestAccessBtn = document.getElementById('requestAccessBtn');
      if (requestAccessBtn) {
        requestAccessBtn.addEventListener('click', function() {
          const profileId = this.getAttribute('data-profile-id');
          const button = this;

          // Disable button and show loading
          button.disabled = true;
          button.innerHTML = '<i class="ri-loader-4-line animate-spin mr-2"></i>Sending Request...';

          // Send request
          fetch(`/interested/${profileId}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              }
            })
            .then(response => response.json())
            .then(data => {
              if (data.error === "incomplete_profile") {
                // Show special notification for incomplete profile
                showIncompleteProfileNotification();

                // Reset button
                button.disabled = false;
                button.innerHTML = '<i class="ri-profile-line mr-2"></i>Request Profile Sharing';
              } else if (data.message) {
                // Show success notification
                showNotification('Request Sent!', "We'll notify you when they respond", 'success');

                // Update button to show request sent
                button.innerHTML = '<i class="ri-time-line mr-2"></i>Request Pending';
                button.className = 'inline-flex items-center gap-2 px-6 py-3 bg-gray-100 text-gray-600 rounded-button';
              } else {
                throw new Error(data.error || 'Failed to send request');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              showNotification('Request Failed', 'Please try again later', 'error');

              // Reset button
              button.disabled = false;
              button.innerHTML = '<i class="ri-profile-line mr-2"></i>Request Profile Sharing';
            });
        });
      }

      // Special notification for incomplete profile
      function showIncompleteProfileNotification() {
        const notification = document.createElement('div');
        notification.className = `fixed bottom-4 right-4 bg-orange-500 text-white rounded-xl p-6 material-shadow-elevated transform translate-y-0 opacity-100 transition-all duration-300 z-50 max-w-sm`;
        notification.innerHTML = `
      <div class="flex items-start gap-3">
        <i class="ri-error-warning-line text-2xl mt-1"></i>
        <div class="flex-1">
          <p class="font-semibold mb-2">Complete Your Profile First</p>
          <p class="text-sm opacity-90 mb-3">You must complete your profile before sending requests to others.</p>
          <a href="/account/info" class="inline-flex items-center gap-2 bg-white text-orange-500 px-4 py-2 rounded-lg text-sm font-medium hover:bg-orange-50 transition-colors">
            <i class="ri-edit-line"></i>
            Complete Profile
          </a>
        </div>
        <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-orange-200 transition-colors">
          <i class="ri-close-line text-xl"></i>
        </button>
      </div>
    `;

        document.body.appendChild(notification);

        // Auto remove after 8 seconds
        setTimeout(() => {
          if (notification.parentElement) {
            notification.style.transform = 'translateY(100%)';
            notification.style.opacity = '0';
            setTimeout(() => {
              if (notification.parentElement) notification.remove();
            }, 300);
          }
        }, 8000);
      }

      // Regular notification function
      function showNotification(title, message, type = 'info') {
        const notification = document.createElement('div');
        const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
        const icon = type === 'success' ? 'ri-checkbox-circle-line' : type === 'error' ? 'ri-error-warning-line' : 'ri-information-line';

        notification.className = `fixed bottom-4 right-4 ${bgColor} text-white rounded-xl p-4 material-shadow-elevated flex items-center gap-3 transform translate-y-0 opacity-100 transition-all duration-300 z-50`;
        notification.innerHTML = `
      <i class="${icon} text-xl"></i>
      <div>
        <p class="font-medium">${title}</p>
        <p class="text-sm opacity-90">${message}</p>
      </div>
    `;

        document.body.appendChild(notification);

        setTimeout(() => {
          notification.style.transform = 'translateY(100%)';
          notification.style.opacity = '0';
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }

      // Dropdown interactions for header

    });
  </script>
  <!-- ...existing code... -->
  <!-- Add this script before closing </body> tag -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const shareBtn = document.getElementById('shareProfileBtn');
      const shareIcon = document.getElementById('shareIcon');
      const shareText = document.getElementById('shareText');
      const profileCard = document.getElementById('profileCard');
      const shareCanvas = document.getElementById('shareCanvas');

      if (shareBtn) {
        shareBtn.addEventListener('click', function() {
          // Disable button and show loading
          shareBtn.disabled = true;
          shareIcon.className = 'ri-loader-4-line animate-spin';
          shareText.textContent = 'Creating Image...';

          // Generate dynamic content based on available data
          generateShareContent();

          // Make the card visible temporarily for capture
          profileCard.style.position = 'fixed';
          profileCard.style.left = '0px';
          profileCard.style.top = '0px';
          profileCard.style.transform = 'none';
          profileCard.style.zIndex = '-1';
          profileCard.style.width = '450px';
          profileCard.style.height = 'auto';
          profileCard.style.overflow = 'visible';
          // Wait a moment for content to render

          setTimeout(() => {
            shareCanvas.style.height = 'auto';
            shareCanvas.style.minHeight = 'auto';
            html2canvas(shareCanvas, {
              backgroundColor: null,
              scale: 2,
              useCORS: true,
              allowTaint: true,
              width: 450,
              height: shareCanvas.scrollHeight, // Use scrollHeight instead of offsetHeight
              scrollX: 0,
              scrollY: 0,
              windowWidth: 450,
              windowHeight: shareCanvas.scrollHeight
            }).then(canvas => {
              // Hide the card again
              profileCard.style.position = 'absolute';
              profileCard.style.left = '-9999px';
              profileCard.style.top = '-9999px';
              profileCard.style.transform = 'none';

              canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);

                if (navigator.share && navigator.canShare && navigator.canShare({
                    files: [new File([blob], 'profile.png', {
                      type: 'image/png'
                    })]
                  })) {
                  navigator.share({
                    title: '<%= profile.name || profile.username %> - Profile',
                    text: 'Check out this profile on D\'Amour Muslim!',
                    files: [new File([blob], 'profile.png', {
                      type: 'image/png'
                    })]
                  }).then(() => {
                    showSuccess();
                  }).catch(() => {
                    fallbackShare(url);
                  });
                } else {
                  fallbackShare(url);
                }
              }, 'image/png', 0.9);
            }).catch(error => {
              console.error('Error generating image:', error);
              showError();
            });
          }, 800);
        });
      }

      function generateShareContent() {
        const canAccess = <%= canAccessFullProfile ? 'true' : 'false' %>;

        // **UPDATED**: Get only the specific profile data needed
        const profileData = {
          username: `<%= profile.username %>`,
          age: `<%= profile.age || '' %>`,
          gender: `<%= profile.gender || '' %>`,

          aboutMe: `<%= (profile.aboutMe || '').replace(/"/g, '\\"').replace(/&/g, '&amp;').replace(/\n/g, ' ') %>`,
          contact: '7454516156',

          willingToRelocate: `<%= profile.willingToRelocate !== undefined ? (typeof profile.willingToRelocate === 'boolean' ? (profile.willingToRelocate ? 'Yes' : 'No') : profile.willingToRelocate) : '' %>`,
          height: `<%= profile.height ? (profile.height / 30.48).toFixed(1) + ' ft' : '' %>`,
          islamicSect: `<%= profile.islamicSect || '' %>`,

          work: `<%= (profile.work || '').replace(/"/g, '\\"').replace(/&/g, '&amp;') %>`,
          education: `<%= profile.education && profile.education.length > 0 && profile.education[0].title ? profile.education[0].title.replace(/"/g, '\\"').replace(/&/g, '&amp;') : '' %>`,
          preferredAgeRange: `<%= profile.preferredAgeRange || '' %>`,
          acceptADivorcedPerson: `<%= profile.acceptADivorcedPerson !== undefined ? (profile.acceptADivorcedPerson ? 'Yes' : 'No') : '' %>`,
          acceptAWidow: `<%= profile.acceptAWidow !== undefined ? (profile.acceptAWidow ? 'Yes' : 'No') : '' %>`,

          lookingForASpouseThatIs: `<%= (profile.lookingForASpouseThatIs || '').replace(/"/g, '\\"').replace(/&/g, '&amp;') %>`
        };
        //blue default was #b3e5fc
        // **UPDATED**: Header with essential info
        const backgroundGradient = `<%= profile.gender === 'female' ? '#F1CADB' : '#b3e5fc' %>`;

        let content = `
    <div style="background: ${backgroundGradient}; border-radius: 14px; padding: 12px; margin-bottom: 6px; box-shadow: 0 4px 12px rgba(233,30,99,0.12); display: flex; align-items: center; justify-content: space-between;">
      <!-- Left Side - Profile Info -->
      <div style="flex: 1; text-align: left;">
        <h1 style="margin: 0 0 6px 0; font-size: 1.4rem; font-weight: 800; color: #1a1a1a; letter-spacing: 0.01em;">
          ${profileData.username} • ${profileData.age ? profileData.age + " years" : ""} • ${profileData.gender ? profileData.gender.charAt(0).toUpperCase() + profileData.gender.slice(1) : ""}
        </h1>
        <p style="margin: 0; font-size: 1rem; font-weight: 700; color: #E91E63;">
          📞 7454516156
        </p>
      </div>
      
      <!-- Divider -->
      <div style="width: 2px; height: 60px; background: rgba(233,30,99,0.3); margin: 0 16px;"></div>
      
      <!-- Right Side - Brand -->
      <div style="flex: 0 0 auto; text-align: center;">
        <p style="margin: 0; font-size: 1.2rem; font-weight: 800; color: #E91E63; line-height: 1.1;">
          D'AMOUR<br>
          <span style="font-size: 1.2rem;">MUSLIM</span>
        </p>
      </div>
    </div>
  `;

        // **SECTION 1**: Basic Information
        const basicInfo = [];
        if (profileData.age) basicInfo.push(["Age", profileData.age]);
        if (profileData.height) basicInfo.push(["Height", profileData.height]);
        if (profileData.work) basicInfo.push(["Profession", profileData.work]);
        if (profileData.education) basicInfo.push(["Education", profileData.education]);

        if (basicInfo.length > 0) {
          content += addSection("📋 Basic Information", basicInfo);
        }

        // **SECTION 2**: About Me
        if (profileData.aboutMe) {
          content += addInlineTextSection("💭 About Me", profileData.aboutMe);
        }

        // **SECTION 3**: Religious Information
        const religiousInfo = [];
        if (profileData.islamicSect) religiousInfo.push(["Islamic Sect", profileData.islamicSect]);
        if (profileData.caste) religiousInfo.push(["Caste", profileData.caste]);

        if (religiousInfo.length > 0) {
          content += addSection("🕌 Religious Information", religiousInfo);
        }

        // **SECTION 5**: Preferences & Expectations
        const preferences = [];
        if (profileData.preferredAgeRange) preferences.push(["Preferred Age", profileData.preferredAgeRange]);
        if (profileData.preferredHeightRange) preferences.push(["Preferred Height", profileData.preferredHeightRange]);
        if (profileData.willingToRelocate) preferences.push(["Willing to Relocate", profileData.willingToRelocate]);
        if (profileData.acceptADivorcedPerson) preferences.push(["Accept Divorced Person", profileData.acceptADivorcedPerson]);
        if (profileData.acceptAWidow) preferences.push(["Accept Widow", profileData.acceptAWidow]);

        if (preferences.length > 0) {
          content += addSection("💕 Partner Preferences", preferences);
        }


        // **SECTION 7**: Looking For
        if (profileData.lookingForASpouseThatIs) {
          content += addInlineTextSection("💝 Looking for a Spouse That Is", profileData.lookingForASpouseThatIs);
        }

        shareCanvas.innerHTML = content;
      }
      // Helper function to add a section with key-value pairs - UPDATED for selective styling


      function addSection(title, items) {
        if (!items || items.length === 0) return '';

        let section = `
    <div style="margin: 4px 0;">
      <h3 style="margin: 0 0 6px 0; font-size: 1.2rem; font-weight: 800; color: #1a365d; padding-bottom: 4px;">${title}</h3>
      <div style=" padding: 12px; border-radius: 10px; ">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
  `;

        items.forEach(item => {
          if (item && item.length === 2) {
            section += `
        <div style="padding: 8px; border-radius: 6px;">
          <p style="margin: 0 0 3px 0; font-size: 0.80rem; color: black; text-transform: uppercase; letter-spacing: 0.5px;">${item[0]}</p>
          <p style="margin: 0; font-size: 1rem; font-weight: 700; color: black; line-height: 1.3;">${item[1]}</p>
        </div>
      `;
          }
        });

        section += `
        </div>
      </div>
    </div>
  `;

        return section;
      }

      // Helper function for text sections (like About Me)
      function addTextSection(title, text) {
        if (!text || text.trim() === '') return '';

        const truncatedText = text.length > 120 ? text.substring(0, 117) + '...' : text;

        return `
    <div style="margin: 6px 0;">
      <h3 style="margin: 0 0 6px 0; font-size: 1.2rem; font-weight: 800; color: #1a365d; border-bottom: 2px solid rgba(233,30,99,0.3); padding-bottom: 4px;">${title}</h3>
      <div style=" padding: 6px; border-radius: 10px; ">
        <p style="margin: 0; font-size: 0.9rem; font-weight: 500; color: #2d3748; line-height: 1.4;">${truncatedText}</p>
      </div>
    </div>
  `;
      }
      // Helper function for inline text sections (heading and text on same line)
      function addInlineTextSection(title, text) {
        if (!text || text.trim() === '') return '';

        const truncatedText = text.length > 100 ? text.substring(0, 97) + '...' : text;

        return `
    <div style="margin: 3px 0;">
      <div style=" padding: 12px; border-radius: 10px; ">
        <p style="margin: 0; font-size: 0.9rem; font-weight: 500; color: #2d3748; line-height: 1.4;">
          <span style="font-size: 1rem; font-weight: 800; color: #1a365d;">${title}:</span> ${truncatedText}
        </p>
      </div>
    </div>
  `;
      }

      // Helper function for tags (like hobbies)
      function addTagSection(title, tags) {
        if (!tags || tags.length === 0) return '';

        let section = `
      <div style="margin: 8px 0;">
        <h3 style="margin: 0 0 6px 0; font-size: 1.3rem; font-weight: bold; opacity: 1;">${title}</h3>
        <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; width: 100%; box-sizing: border-box;">
    `;

        tags.forEach(tag => {
          section += `<span style="display: inline-block; background: rgba(255,255,255,0.2); padding: 3px 8px; border-radius: 12px; font-size: 0.7rem; margin: 2px;">${tag}</span>`;
        });

        section += `
        </div>
      </div>
    `;

        return section;
      }

      // Keep your existing success/error functions
      function fallbackShare(imageUrl) {
        const a = document.createElement('a');
        a.href = imageUrl;
        a.download = '<%= profile.username %>_profile.png';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(imageUrl);
        showSuccess();
      }

      function showSuccess() {
        shareIcon.className = 'ri-check-line';
        shareText.textContent = 'Copied!';
        shareBtn.style.background = '#10B981';
        showNotification('Profile image created!', 'You can now share it on WhatsApp or other platforms', 'success');

        setTimeout(() => {
          shareIcon.className = 'ri-share-line';
          shareText.textContent = 'Share Profile';
          shareBtn.style.background = '';
          shareBtn.disabled = false;
        }, 3000);
      }

      function showError() {
        shareIcon.className = 'ri-error-warning-line';
        shareText.textContent = 'Failed';
        shareBtn.style.background = '#EF4444';
        showNotification('Error', 'Failed to create profile image', 'error');

        setTimeout(() => {
          shareIcon.className = 'ri-share-line';
          shareText.textContent = 'Share Profile';
          shareBtn.style.background = '';
          shareBtn.disabled = false;
        }, 3000);
      }

      function showNotification(title, message, type) {
        const notification = document.createElement('div');
        const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
        const icon = type === 'success' ? 'ri-check-circle-line' : 'ri-error-warning-line';

        notification.className = `fixed bottom-4 right-4 ${bgColor} text-white rounded-xl p-4 shadow-lg flex items-center gap-3 z-50 transform transition-all duration-300`;
        notification.innerHTML = `
      <i class="${icon} text-xl"></i>
      <div>
        <p class="font-medium">${title}</p>
        <p class="text-sm opacity-90">${message}</p>
      </div>
      <button onclick="this.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
        <i class="ri-close-line text-lg"></i>
      </button>
    `;

        document.body.appendChild(notification);

        setTimeout(() => {
          if (notification.parentElement) {
            notification.style.transform = 'translateX(100%)';
            notification.style.opacity = '0';
            setTimeout(() => notification.remove(), 300);
          }
        }, 5000);
      }
    });
  </script>
  <!-- Add this JavaScript right before the closing </body> tag -->

</body>

</html>